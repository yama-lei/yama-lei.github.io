---
title: 第四章：程序的链接
date: 2025-09-29
categories:
  - NJUCS
  - ICS计算系统基础
tags:
  - class-notes
---
---

> [!NOTE] Note
> 老师说这一章很重要，特别是函数调用部分，要能够读懂函数调用的过程


听到了代码，栈，三个寄存器（EBP，ESP，EIP）来完成整个函数的调用之类的东西

将来会叫我们画函数的栈帧，里面会有eax ebx之类的东西，会有局部变量，会有函数的参数等等

在函数的执行过程中，ebp不变，一直指向栈帧基址

> [!NOTE] 栈帧形状
> ```[高地址]
> 参数 (caller传的)
> 返回地址 (call压入)
> 旧 ebp (push ebp 保存的)
> ------------------ ← ebp 指向这里 (栈帧基址)
> 局部变量区 (向低地址扩展)
> 临时保存的寄存器
> ------------------ ← esp 指向这里 (栈顶)
> [低地址]
>
> 所以参数的访问都是用 ebp + 偏移量来访问，返回值一般都在 eax 寄存器中，如果是浮点数，那么就是压入 XX（这个不考）
> ```
> 


**栈帧必须要会画**

以这个代码为
```c
int add ( int x, int y ) {
	 return x+y;
}
int	 caller ( ) {	
	 int	t1 = 125;
      int 	t2 = 80;
	 int	sum = add (t1, t2);
	 return sum;
}
```

leave的作用是 mov ebp esp; pop ebp，也就是把esp的值改为ebp的值，然后把栈顶的值（现在栈顶就是ebp所指的位置，也就是

ebp+8是第一个参数，ebp+c是第二个参数
在这里的esp没有改变，因此无需调用

在分析汇编代码的时候，需要注意eax通常是result，因为eax